<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>СПУ-52-3 — расчёт передаточных чисел</title>

  <!-- MathJax (формулы дробями, как в CodePen) -->
  <script>
    window.MathJax = {
      tex: { inlineMath: [['\\(','\\)'], ['$', '$']] },
      svg: { fontCache: 'global' }
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

  <style>
    :root{
      --bgTop: #1d6fe6; /* голубой сверху */
      --bgBot: #ffd400; /* жёлтый снизу */
      --glass: rgba(255,255,255,.14);
      --glass2: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.22);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --ok: rgba(60, 255, 170, .95);
      --bad: rgba(255, 80, 80, .95);
      --warn: rgba(255, 210, 70, .98);
      --shadow: 0 18px 60px rgba(0,0,0,.35);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      overflow-x:hidden;
      background: linear-gradient(180deg, var(--bgTop) 0%, var(--bgTop) 49%, var(--bgBot) 51%, var(--bgBot) 100%);
    }

    /* 3D / “волна” флага */
    .flag3d{
      position:fixed; inset:-20vh -10vw;
      pointer-events:none;
      filter: saturate(1.12) contrast(1.05);
    }
    .flag3d::before,
    .flag3d::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(1200px 700px at 20% 15%, rgba(255,255,255,.18), transparent 55%),
        radial-gradient(900px 600px at 80% 35%, rgba(0,0,0,.22), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.10));
      mix-blend-mode: overlay;
      transform: rotate(-2deg);
    }
    .flag3d::after{
      background:
        repeating-linear-gradient(120deg, rgba(255,255,255,.08) 0 12px, rgba(255,255,255,0) 12px 24px),
        radial-gradient(900px 900px at 60% 70%, rgba(0,0,0,.18), transparent 60%);
      opacity:.55;
      animation: shimmer 8s ease-in-out infinite;
    }
    @keyframes shimmer{
      0%,100%{ transform: translate3d(0,0,0) rotate(-2deg); }
      50%{ transform: translate3d(-12px, 8px, 0) rotate(-1deg); }
    }

    .wrap{
      position:relative;
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 18px 36px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
    }

    h1{
      margin:0;
      font-size: clamp(20px, 2.8vw, 34px);
      letter-spacing: .3px;
      text-shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    .sub{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
      max-width: 820px;
    }

    .chips{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      margin-top:2px;
    }
    .chip{
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      padding: 8px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
      .chips{ justify-content:flex-start; }
    }

    .card{
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--stroke);
      border-radius: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      overflow:hidden;
    }
    .cardHead{
      padding: 14px 14px 10px;
      border-bottom: 1px solid rgba(255,255,255,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }
    .cardHead h2{
      margin:0;
      font-size: 16px;
    }
    .cardHead .hint{
      margin:0;
      font-size: 12px;
      color: var(--muted);
      max-width: 560px;
      line-height: 1.35;
    }
    .cardBody{
      padding: 14px;
      display:grid;
      gap: 12px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 520px){
      .row{ grid-template-columns: 1fr; }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-size: 12px;
      color: var(--muted);
    }
    input{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 14px;
    }
    input::placeholder{ color: rgba(255,255,255,.45); }
    input:focus{
      border-color: rgba(255,255,255,.35);
      box-shadow: 0 0 0 4px rgba(255,255,255,.10);
    }

    .formula{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.14);
      color: rgba(255,255,255,.90);
      font-size: 13px;
      line-height: 1.5;
    }

    .outGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 620px){
      .outGrid{ grid-template-columns: 1fr; }
    }

    .out{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.14);
    }
    .out .k{ color: var(--muted); font-size: 12px; }
    .out .v{ font-size: 16px; margin-top: 4px; }
    .out.ok{ border-color: rgba(60,255,170,.35); }
    .out.bad{ border-color: rgba(255,80,80,.40); }
    .out.warn{ border-color: rgba(255,210,70,.35); }

    .statusLine{
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.14);
      font-size: 13px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .badge{
      padding: 5px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.16);
    }
    .badge.ok{ color: var(--ok); border-color: rgba(60,255,170,.30); }
    .badge.bad{ color: var(--bad); border-color: rgba(255,80,80,.35); }
    .badge.warn{ color: var(--warn); border-color: rgba(255,210,70,.30); }

    details{
      border-top: 1px solid rgba(255,255,255,.14);
      padding-top: 10px;
    }
    summary{
      cursor:pointer;
      color: var(--muted);
      font-size: 12px;
      user-select:none;
    }
    pre{
      margin:10px 0 0;
      white-space:pre-wrap;
      word-break:break-word;
      font-size: 12px;
      color: rgba(255,255,255,.80);
      background: rgba(0,0,0,.14);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      padding: 10px 12px;
    }

    footer{
      margin-top: 14px;
      color: rgba(255,255,255,.62);
      font-size: 12px;
      line-height: 1.35;
      text-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
  </style>
</head>

<body>
  <div class="flag3d"></div>

  <div class="wrap">
    <header>
      <div class="title">
        <h1>СПУ-52-3 — расчёт передаточных чисел</h1>
        <div class="sub">
          Авто-расчёт при вводе. Давление — по гипсометрии (мм рт.ст.). Температура — по таблице <span class="mono">R(Ом) ↔ T(°C)</span>.
          Формулы показаны “как в CodePen” (дробями).
        </div>
      </div>

      <div class="chips">
        <div class="chip">Флаг: сверху голубой / снизу жёлтый ✅</div>
        <div class="chip">Округление: 3 знака</div>
        <div class="chip">Подсветка результата вне допуска</div>
      </div>
    </header>

    <div class="grid">
      <!-- Давление -->
      <section class="card" id="cardP">
        <div class="cardHead">
          <div>
            <h2>Давление по гипсометрической таблице</h2>
            <p class="hint">
              Вводишь <b>P(1000)</b> (как у тебя на приборе/КПУ) и высоту <b>H</b>.
              Табличное <b>Pтаб(1000)=674.115</b>. Коррекция: <span class="mono">P(H)=Pтаб(H)+[P(1000)−Pтаб(1000)]</span>.
              Для расчёта передаточного числа используем: \(\; i_p=\dfrac{33.3}{\Delta P}\;\), где \(\Delta P = Pтаб(1000)-Pтаб(H)\).
            </p>
          </div>
        </div>

        <div class="cardBody">
          <div class="row">
            <div class="field">
              <label for="p1000">P(1000), мм рт.ст. (по прибору)</label>
              <input id="p1000" inputmode="decimal" placeholder="например 674.000" value="674">
            </div>
            <div class="field">
              <label for="h">H, м (промежуточная отметка)</label>
              <input id="h" inputmode="numeric" placeholder="например 1420" value="200">
            </div>
          </div>

          <div class="formula" id="formulaP">
            \[
              P(H)=P_{таб}(H)+\bigl(P(1000)-P_{таб}(1000)\bigr),
              \quad
              \Delta P=P_{таб}(1000)-P_{таб}(H),
              \quad
              i_p=\frac{33.3}{\Delta P}
            \]
          </div>

          <div class="outGrid">
            <div class="out" id="p_tab_h_box">
              <div class="k">Pтаб(H), мм рт.ст.</div>
              <div class="v" id="p_tab_h">—</div>
            </div>
            <div class="out" id="p_h_box">
              <div class="k">P(H) после коррекции, мм рт.ст.</div>
              <div class="v" id="p_h">—</div>
            </div>

            <div class="out" id="dp_box">
              <div class="k">ΔP = Pтаб(1000) − Pтаб(H), мм рт.ст.</div>
              <div class="v" id="dp">—</div>
            </div>
            <div class="out" id="ip_box">
              <div class="k">Передаточное число по давлению iₚ</div>
              <div class="v" id="ip">—</div>
            </div>
          </div>

          <div class="statusLine">
            <div>Статус</div>
            <div class="badge" id="p_badge">—</div>
          </div>

          <details>
            <summary>Показать расчёт (debug)</summary>
            <pre id="p_debug">—</pre>
          </details>
        </div>
      </section>

      <!-- Температура -->
      <section class="card" id="cardT">
        <div class="cardHead">
          <div>
            <h2>Температура (R → T → ΔT → iT)</h2>
            <p class="hint">
              Вводишь сопротивления <b>R1</b> и <b>R2</b>. Программа по таблице находит <b>T1</b> и <b>T2</b> (линейная интерполяция).
              Дальше: \(\Delta T_1=T_1-7\), \(\Delta T_2=T_2-7\), \(\; i_T=\dfrac{33.3}{\Delta T}\).
              Подсветка красным — если iT вне допуска.
            </p>
          </div>
        </div>

        <div class="cardBody">
          <div class="row">
            <div class="field">
              <label for="r1">R1, Ом</label>
              <input id="r1" inputmode="decimal" placeholder="например 92.6" value="105">
            </div>
            <div class="field">
              <label for="r2">R2, Ом</label>
              <input id="r2" inputmode="decimal" placeholder="например 105.0" value="104.86">
            </div>
          </div>

          <div class="formula" id="formulaT">
            \[
              T=f(R) \text{ (по таблице, линейно)},
              \quad
              \Delta T=T-7,
              \quad
              i_T=\frac{33.3}{\Delta T}
            \]
          </div>

          <div class="outGrid">
            <div class="out" id="t1_box">
              <div class="k">T1, °C (по таблице)</div>
              <div class="v" id="t1">—</div>
            </div>
            <div class="out" id="t2_box">
              <div class="k">T2, °C (по таблице)</div>
              <div class="v" id="t2">—</div>
            </div>

            <div class="out" id="dt1_box">
              <div class="k">ΔT1 = T1 − 7</div>
              <div class="v" id="dt1">—</div>
            </div>
            <div class="out" id="dt2_box">
              <div class="k">ΔT2 = T2 − 7</div>
              <div class="v" id="dt2">—</div>
            </div>

            <div class="out" id="it1_box">
              <div class="k">iT1 = 33.3 / ΔT1</div>
              <div class="v" id="it1">—</div>
            </div>
            <div class="out" id="it2_box">
              <div class="k">iT2 = 33.3 / ΔT2</div>
              <div class="v" id="it2">—</div>
            </div>
          </div>

          <div class="statusLine">
            <div>Статус</div>
            <div class="badge" id="t_badge">—</div>
          </div>

          <details>
            <summary>Показать расчёт (debug)</summary>
            <pre id="t_debug">—</pre>
          </details>
        </div>
      </section>
    </div>

    <footer>
      Примечание: если ты снова захочешь подтягивать таблицы из <span class="mono">spu52.json</span> — сначала почини JSON (ошибка “Unexpected non-whitespace…” означает, что файл невалидный).
      Этот вариант работает автономно (таблицы встроены).
    </footer>
  </div>

  <script>
    // -----------------------------
    // ДАННЫЕ (встроены, без spu52.json)
    // -----------------------------

    // Гипсометрия (из твоих значений). мм рт.ст.
    // Включил 0, 20, 40, 60, 100..3000.
    const hyps = [
      {H:0,    P:760.000},
      {H:20,   P:758.200},
      {H:40,   P:756.403},
      {H:60,   P:754.609},
      {H:100,  P:751.033},
      {H:200,  P:742.151},
      {H:300,  P:733.355},
      {H:400,  P:724.643},
      {H:500,  P:716.015},
      {H:600,  P:707.471},
      {H:700,  P:699.009},
      {H:800,  P:690.630},
      {H:900,  P:682.332},
      {H:1000, P:674.115},
      {H:1100, P:665.978},
      {H:1200, P:657.921},
      {H:1300, P:649.943},
      {H:1400, P:642.044},
      {H:1500, P:634.222},
      {H:1600, P:626.478},
      {H:1700, P:618.811},
      {H:1800, P:611.219},
      {H:1900, P:603.704},
      {H:2000, P:596.263},
      {H:2100, P:588.897},
      {H:2200, P:581.605},
      {H:2300, P:574.385},
      {H:2400, P:567.239},
      {H:2500, P:560.165},
      {H:2600, P:553.162},
      {H:2700, P:546.231},
      {H:2800, P:539.370},
      {H:2900, P:532.579},
      {H:3000, P:525.857},
    ];

    // Температура ↔ сопротивление (табл.1 с фото).
    // На фото строка +60 “смазана” (выглядит как +50). Здесь принял как +60.
    // Для +100 в фото строчка не попала в кадр; оставил интерполяцию между +90 и +110,
    // поэтому +100 получится автоматически.
    const tempTable = [
      {T:-40, R:76.86},
      {T:-30, R:79.96},
      {T:-20, R:83.16},
      {T:-10, R:86.56},
      {T:  0, R:90.26},
      {T:+10, R:93.76},
      {T:+20, R:97.36},
      {T:+30, R:101.06},
      {T:+40, R:104.86},
      {T:+50, R:108.81},
      {T:+60, R:112.78},   // смазано в кадре, но по последовательности это +60
      {T:+70, R:116.96},
      {T:+80, R:121.22},
      {T:+90, R:125.56},
      // +100 нет в кадре — получим интерполяцией между +90 и +110
      {T:+110, R:134.41},
      {T:+120, R:138.96},
      {T:+130, R:143.56},
    ].sort((a,b)=>a.R-b.R);

    // Допуск по температуре (из твоей техкарты на фото): 0.85 ± 0.17
    const IT_MIN = 0.85 - 0.17; // 0.68
    const IT_MAX = 0.85 + 0.17; // 1.02

    // -----------------------------
    // УТИЛИТЫ
    // -----------------------------
    const fmt3 = (x) => (Number.isFinite(x) ? (Math.round(x*1000)/1000).toFixed(3) : '—');
    const fmt2 = (x) => (Number.isFinite(x) ? (Math.round(x*100)/100).toFixed(2) : '—');

    function parseNum(v){
      if (typeof v !== 'string') return NaN;
      const s = v.trim().replace(',', '.');
      if (!s) return NaN;
      return Number(s);
    }

    function clamp(x, a, b){ return Math.max(a, Math.min(b, x)); }

    // Линейная интерполяция по таблице {x,y}
    function lerp(x0,y0,x1,y1,x){
      if (x1 === x0) return y0;
      return y0 + (y1-y0) * ((x - x0)/(x1-x0));
    }

    // По высоте H → Pтаб(H) (линейно между ближайшими точками)
    function pTabAtH(H){
      if (!Number.isFinite(H)) return NaN;
      const hMin = hyps[0].H, hMax = hyps[hyps.length-1].H;
      const h = clamp(H, hMin, hMax);

      // точное совпадение
      for (const r of hyps) if (r.H === h) return r.P;

      // найти интервал
      let i = 0;
      while (i < hyps.length-1 && hyps[i+1].H < h) i++;
      const a = hyps[i], b = hyps[i+1];
      return lerp(a.H, a.P, b.H, b.P, h);
    }

    // По сопротивлению R → температура T (линейно между ближайшими точками)
    function tempFromR(R){
      if (!Number.isFinite(R)) return NaN;
      const t = tempTable;

      // диапазон
      const rMin = t[0].R, rMax = t[t.length-1].R;
      const r = clamp(R, rMin, rMax);

      // точное совпадение
      for (const p of t) if (Math.abs(p.R - r) < 1e-9) return p.T;

      // интервал
      let i = 0;
      while (i < t.length-1 && t[i+1].R < r) i++;
      const a = t[i], b = t[i+1];
      return lerp(a.R, a.T, b.R, b.T, r);
    }

    function setBoxState(box, state){ // 'ok' | 'bad' | 'warn' | ''
      box.classList.remove('ok','bad','warn');
      if (state) box.classList.add(state);
    }

    // -----------------------------
    // РАСЧЁТ: ДАВЛЕНИЕ
    // -----------------------------
    function calcPressure(){
      const p1000 = parseNum(document.getElementById('p1000').value);
      const H = parseNum(document.getElementById('h').value);

      const Ptab1000 = pTabAtH(1000);
      const PtabH = pTabAtH(H);

      // P(H) = Ptab(H) + (P(1000)-Ptab(1000))
      const PH = Number.isFinite(p1000) && Number.isFinite(Ptab1000) && Number.isFinite(PtabH)
        ? (PtabH + (p1000 - Ptab1000))
        : NaN;

      // ΔP = Ptab(1000) - Ptab(H)
      const dP = Number.isFinite(Ptab1000) && Number.isFinite(PtabH) ? (Ptab1000 - PtabH) : NaN;

      // ip = 33.3 / ΔP
      const ip = Number.isFinite(dP) && Math.abs(dP) > 1e-9 ? (33.3 / dP) : NaN;

      document.getElementById('p_tab_h').textContent = fmt3(PtabH);
      document.getElementById('p_h').textContent = fmt3(PH);
      document.getElementById('dp').textContent = fmt3(dP);
      document.getElementById('ip').textContent = fmt3(ip);

      // статус по смыслу: если H <= 1000 → ΔP <= 0 и ip отрицательный/невалидный для твоей логики
      const badge = document.getElementById('p_badge');
      const ipBox = document.getElementById('ip_box');
      const dpBox = document.getElementById('dp_box');

      let st = '';
      let txt = '—';

      if (!Number.isFinite(p1000) || !Number.isFinite(H)){
        st = 'warn'; txt = 'Введите P(1000) и H';
      } else if (!Number.isFinite(PtabH)){
        st = 'bad'; txt = 'Нет данных гипсометрии для H';
      } else if (!Number.isFinite(ip) || !Number.isFinite(dP)){
        st = 'bad'; txt = 'ΔP=0 или ошибка расчёта';
      } else if (dP <= 0){
        st = 'warn'; txt = 'H ≤ 1000 → ΔP ≤ 0 (проверь, какая отметка нужна)';
      } else {
        st = 'ok'; txt = 'OK';
      }

      badge.className = 'badge ' + st;
      badge.textContent = txt;

      // подсветка результата: если ip отрицательный/NaN — красным
      setBoxState(ipBox, (st==='bad') ? 'bad' : (st==='warn' ? 'warn' : 'ok'));
      setBoxState(dpBox, (st==='bad') ? 'bad' : (st==='warn' ? 'warn' : 'ok'));

      document.getElementById('p_debug').textContent =
        [
          `Ввод: P(1000)=${p1000}, H=${H}`,
          `Таблица: Pтаб(1000)=${Ptab1000}, Pтаб(H)=${PtabH}`,
          `Коррекция: P(H)=Pтаб(H)+(P(1000)-Pтаб(1000)) = ${PH}`,
          `ΔP = Pтаб(1000)-Pтаб(H) = ${dP}`,
          `iₚ = 33.3/ΔP = ${ip}`
        ].join('\n');

      // обновить MathJax (если уже прогрузился)
      if (window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
    }

    // -----------------------------
    // РАСЧЁТ: ТЕМПЕРАТУРА
    // -----------------------------
    function calcTemp(){
      const r1 = parseNum(document.getElementById('r1').value);
      const r2 = parseNum(document.getElementById('r2').value);

      const T1 = tempFromR(r1);
      const T2 = tempFromR(r2);

      const dT1 = Number.isFinite(T1) ? (T1 - 7) : NaN;
      const dT2 = Number.isFinite(T2) ? (T2 - 7) : NaN;

      const iT1 = Number.isFinite(dT1) && Math.abs(dT1) > 1e-9 ? (33.3 / dT1) : NaN;
      const iT2 = Number.isFinite(dT2) && Math.abs(dT2) > 1e-9 ? (33.3 / dT2) : NaN;

      document.getElementById('t1').textContent = fmt2(T1);
      document.getElementById('t2').textContent = fmt2(T2);
      document.getElementById('dt1').textContent = fmt2(dT1);
      document.getElementById('dt2').textContent = fmt2(dT2);
      document.getElementById('it1').textContent = fmt3(iT1);
      document.getElementById('it2').textContent = fmt3(iT2);

      const badge = document.getElementById('t_badge');

      const it1Box = document.getElementById('it1_box');
      const it2Box = document.getElementById('it2_box');

      function inTol(x){ return Number.isFinite(x) && x >= IT_MIN && x <= IT_MAX; }

      let st = '';
      let txt = '—';

      if (!Number.isFinite(r1) && !Number.isFinite(r2)){
        st = 'warn'; txt = 'Введите R1/R2';
      } else {
        const ok1 = inTol(iT1);
        const ok2 = inTol(iT2);

        if ((Number.isFinite(iT1) && !ok1) || (Number.isFinite(iT2) && !ok2)){
          st = 'bad';
          txt = `Вне допуска (норма iT: ${IT_MIN.toFixed(2)}…${IT_MAX.toFixed(2)})`;
        } else if ((Number.isFinite(iT1) && ok1) || (Number.isFinite(iT2) && ok2)){
          st = 'ok';
          txt = `OK (норма iT: ${IT_MIN.toFixed(2)}…${IT_MAX.toFixed(2)})`;
        } else {
          st = 'warn';
          txt = 'Проверь ввод (ΔT=0 или нет данных)';
        }

        // подсветка каждого iT отдельно
        if (Number.isFinite(iT1)) setBoxState(it1Box, ok1 ? 'ok' : 'bad'); else setBoxState(it1Box,'warn');
        if (Number.isFinite(iT2)) setBoxState(it2Box, ok2 ? 'ok' : 'bad'); else setBoxState(it2Box,'warn');
      }

      badge.className = 'badge ' + st;
      badge.textContent = txt;

      document.getElementById('t_debug').textContent =
        [
          `Ввод: R1=${r1}, R2=${r2}`,
          `T1=f(R1)=${T1}, T2=f(R2)=${T2}`,
          `ΔT1=T1-7=${dT1}, ΔT2=T2-7=${dT2}`,
          `iT1=33.3/ΔT1=${iT1}, iT2=33.3/ΔT2=${iT2}`,
          `Допуск iT: ${IT_MIN} .. ${IT_MAX}`,
          `Примечание: если R выходит за диапазон таблицы — зажимается по краям.`
        ].join('\n');

      if (window.MathJax && MathJax.typesetPromise) MathJax.typesetPromise();
    }

    // -----------------------------
    // Авто-расчёт (как ты хотел: ввёл — сразу посчиталось)
    // -----------------------------
    function hookAuto(id, fn){
      const el = document.getElementById(id);
      el.addEventListener('input', fn);
      el.addEventListener('change', fn);
    }

    hookAuto('p1000', calcPressure);
    hookAuto('h', calcPressure);
    hookAuto('r1', calcTemp);
    hookAuto('r2', calcTemp);

    // стартовый расчёт
    calcPressure();
    calcTemp();
  </script>
</body>
</html>
