
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>СПУУ-52-3 — калькулятор передаточных чисел</title>

  <!-- KaTeX: формулы дробями -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <style>
    :root{
      --blue:#0b46ff;   /* сверху СИНИЙ */
      --yellow:#ffd83a; /* снизу ЖЁЛТЫЙ */
      --glass: rgba(255,255,255,.10);
      --stroke: rgba(255,255,255,.22);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --ok:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow: 0 18px 60px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.18), transparent 55%),
        linear-gradient(180deg, var(--blue) 0%, var(--blue) 46%, var(--yellow) 46%, var(--yellow) 100%);
    }
    .wrap{
      max-width: 1180px;
      margin: 0 auto;
      padding: 26px 16px 44px;
    }
    header{display:flex;flex-direction:column;gap:10px;margin-bottom:18px}
    .title{font-weight: 950; letter-spacing:.4px; font-size: clamp(22px,3.2vw,34px)}
    .sub{
      color:var(--muted);
      line-height:1.25;
      font-size: 13px;
      max-width: 1000px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 980px){ .grid{grid-template-columns:1fr;} }

    .card{
      background: var(--glass);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card h2{margin:0;padding:16px 16px 10px;font-size:18px;font-weight:900}
    .content{padding:0 16px 16px}

    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 520px){ .row{grid-template-columns:1fr;} }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.18);
      color: var(--text);
      outline:none;
      font-size: 16px;
    }
    input::placeholder{color:rgba(255,255,255,.45)}
    input:focus{border-color:rgba(255,255,255,.40); background: rgba(0,0,0,.22)}

    .formulaBox{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.14);
    }
    .small{color:var(--muted); font-size:12px; line-height:1.25}
    .katex{font-size:1.06em}

    .kv{
      margin-top: 12px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){ .kv{grid-template-columns:1fr;} }

    .pill{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.12);
      min-height: 52px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap: 3px;
    }
    .pill b{font-size:18px; letter-spacing:.2px}
    .pill span{font-size:12px;color:var(--muted)}

    .status{
      margin-top: 12px;
      border-radius:14px;
      padding:12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .msg{color:var(--muted); font-size:12px; line-height:1.25}
    .badge{
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 900;
      letter-spacing:.4px;
      font-size:12px;
      white-space:nowrap;
      border:1px solid transparent;
    }
    .badge.ok{background: rgba(34,197,94,.18); border-color: rgba(34,197,94,.45); color:#d8ffe7;}
    .badge.bad{background: rgba(239,68,68,.18); border-color: rgba(239,68,68,.45); color:#ffe1e1;}
    .badge.warn{background: rgba(245,158,11,.18); border-color: rgba(245,158,11,.45); color:#fff2d3;}

    details{margin-top:14px;border-top:1px solid rgba(255,255,255,.16)}
    summary{cursor:pointer;padding:12px 0;color:rgba(255,255,255,.90);font-weight:800;list-style:none}
    summary::-webkit-details-marker{display:none}

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.10);
      margin-top: 10px;
    }
    th,td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      font-size:13px;
    }
    th{text-align:left;color:rgba(255,255,255,.85)}
    td{color:rgba(255,255,255,.82)}
    tr:last-child td{border-bottom:none}

    .tech{
      margin-top: 16px;
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.12);
      box-shadow: var(--shadow);
    }
    .tech h3{margin:0 0 8px;font-size:16px;font-weight:950}
    .tech p, .tech li{
      margin:0 0 8px;
      color:rgba(255,255,255,.86);
      line-height:1.35;
      font-size:13px;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}
    .foot{margin-top:12px;color:rgba(255,255,255,.65);font-size:12px;line-height:1.25}
    .btnRow{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap}
    button{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.16);
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
    }
    button:hover{background: rgba(0,0,0,.22)}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="title">СПУУ-52-3 — калькулятор передаточных чисел</div>
      <div class="sub">
        <b>Нулевые условия:</b> давление <span class="mono">674 мм рт.ст.</span> и сопротивление <span class="mono">92.6 Ω</span> (соответствует <span class="mono">+7°C</span>).
        Индекс на БУ-32 должен стать по середине. Дальше создаёшь разряжение до левой/правой промежуточной отметки и вводишь измеренные значения.
      </div>
    </header>

    <div class="grid">

      <!-- Давление -->
      <section class="card">
        <h2>Давление (по гипсометрической таблице)</h2>
        <div class="content">

          <div class="row">
            <div>
              <label for="p1000">P(1000) по прибору, мм рт.ст.</label>
              <input id="p1000" inputmode="decimal" placeholder="например 674.115" />
            </div>
            <div>
              <label for="H">H по высотомеру на левой промежуточной отметке, м</label>
              <input id="H" inputmode="decimal" placeholder="например 2800" />
            </div>
          </div>

          <div class="formulaBox">
            <div class="small">Гипсометрия уже внутри. Ты вводишь только высоту H — программа сама берёт Pтаб(H).</div>
            <div class="math" data-katex="P_{таб}(H)\; \Rightarrow\;\Delta P_{таб}=P_{таб}(1000)-P_{таб}(H),\quad P(H)=P(1000)-\Delta P_{таб},\quad i_P=\frac{33.3}{\Delta P_{таб}}"></div>
            <div class="small" style="margin-top:8px">
              <b>Проверка по высоте (как ты сказал):</b> <span class="mono">H</span> должен быть в диапазоне <span class="mono">2021…3048</span>.
            </div>
          </div>

          <div class="kv">
            <div class="pill">
              <span>Pтаб(1000), мм рт.ст.</span>
              <b class="mono" id="pt1000">—</b>
            </div>
            <div class="pill">
              <span>Pтаб(H), мм рт.ст.</span>
              <b class="mono" id="ptH">—</b>
            </div>

            <div class="pill">
              <span>ΔPтаб = Pтаб(1000) − Pтаб(H)</span>
              <b class="mono" id="dP">—</b>
            </div>
            <div class="pill">
              <span>P(H) = P(1000) − ΔPтаб</span>
              <b class="mono" id="pH">—</b>
            </div>

            <div class="pill">
              <span>Передаточное число iP</span>
              <b class="mono" id="iP">—</b>
            </div>
            <div class="pill">
              <span>Норма iP</span>
              <b class="mono">0.26…0.38</b>
            </div>

            <div class="pill" style="grid-column:1/-1">
              <span>Контроль высоты H</span>
              <b class="mono" id="hCheck">—</b>
            </div>
          </div>

          <div class="status">
            <div class="msg" id="pMsg">—</div>
            <div class="badge warn" id="pBadge">НЕТ ДАННЫХ</div>
          </div>

          <details>
            <summary>Показать гипсометрическую таблицу (вшита)</summary>
            <div class="btnRow">
              <button id="btnShowHypso">Показать 0…3000 (шаг как в таблице)</button>
              <button id="btnClearHypso">Скрыть</button>
            </div>
            <div id="hypsoWrap"></div>
          </details>

        </div>
      </section>

      <!-- Температура -->
      <section class="card">
        <h2>Температура</h2>
        <div class="content">

          <div class="row">
            <div>
              <label for="R1">R1, Ω (левая промежуточная отметка)</label>
              <input id="R1" inputmode="decimal" placeholder="например 105.0" />
            </div>
            <div>
              <label for="R2">R2, Ω (правая промежуточная отметка)</label>
              <input id="R2" inputmode="decimal" placeholder="например 80.0" />
            </div>
          </div>

          <div class="formulaBox">
            <div class="small">Сначала переводим сопротивление в температуру по таблице (линейная интерполяция), затем:</div>
            <div class="math" data-katex="T=f(R),\quad \Delta T=T-7,\quad i_T=\frac{33.3}{|\Delta T|}"></div>
            <div class="small" style="margin-top:8px">iT всегда положительное (используем |ΔT|).</div>
          </div>

          <div class="kv">
            <div class="pill">
              <span>T1 по таблице, °C</span>
              <b class="mono" id="T1">—</b>
            </div>
            <div class="pill">
              <span>T2 по таблице, °C</span>
              <b class="mono" id="T2">—</b>
            </div>

            <div class="pill">
              <span>ΔT1 = T1 − 7</span>
              <b class="mono" id="dT1">—</b>
            </div>
            <div class="pill">
              <span>ΔT2 = T2 − 7</span>
              <b class="mono" id="dT2">—</b>
            </div>

            <div class="pill">
              <span>iT1 = 33.3 / |ΔT1|</span>
              <b class="mono" id="iT1">—</b>
            </div>
            <div class="pill">
              <span>iT2 = 33.3 / |ΔT2|</span>
              <b class="mono" id="iT2">—</b>
            </div>

            <div class="pill" style="grid-column:1/-1">
              <span>Итог iT (по введённой точке/точкам)</span>
              <b class="mono" id="iTfinal">—</b>
            </div>
          </div>

          <div class="status">
            <div class="msg" id="tMsg">—</div>
            <div class="badge warn" id="tBadge">НЕТ ДАННЫХ</div>
          </div>

          <details open>
            <summary>Показать таблицу R→T (используемую для интерполяции)</summary>
            <div id="rtWrap"></div>
          </details>

        </div>
      </section>
    </div>

    <!-- Технология -->
    <section class="tech">
      <h3>СПУУ-52-3 — технология (на странице)</h3>
      <details open>
        <summary>Развернуть / свернуть</summary>

        <p><b>Нулевые условия (контроль среднего положения):</b> установить на барометрической шкале <span class="mono">674 мм рт.ст.</span>,
          на магазине сопротивлений <span class="mono">92.6 Ω</span> (соответствует <span class="mono">+7°C</span>).
          Создать разряжение так, чтобы индекс на БУ-32 стал по середине.</p>

        <p><b>Проверка по температуре:</b></p>
        <ul>
          <li>Изменяя сопротивление магазина (шагом 0.1 Ω), добиться смещения индекса до левой промежуточной отметки — записать R1.</li>
          <li>Изменяя сопротивление в другую сторону, добиться правой промежуточной отметки — записать R2.</li>
          <li>По таблице перевести R→T. Затем <span class="mono">ΔT = T − 7</span> и <span class="mono">iT = 33.3 / |ΔT|</span>.</li>
          <li>Норма: <span class="mono">iT = 0.85 ± 0.17</span> → <span class="mono">0.68…1.02</span>.</li>
        </ul>

        <p><b>Проверка по давлению (по высоте):</b></p>
        <ul>
          <li>Установить барометрическую шкалу <span class="mono">674 мм рт.ст.</span>.</li>
          <li>Создать разряжение и выставить <span class="mono">1000 м</span> по высотомеру (опорная точка) — удерживать.</li>
          <li>Создать разряжение, при котором индекс сместится до <b>левой промежуточной отметки</b>, считать высоту <span class="mono">H</span> по высотомеру.</li>
          <li><b>Диапазон высоты:</b> <span class="mono">H = 2021…3048</span>.</li>
          <li>По гипсометрической таблице взять <span class="mono">Pтаб(1000)</span> и <span class="mono">Pтаб(H)</span>, затем:
            <span class="mono">ΔPтаб = Pтаб(1000) − Pтаб(H)</span>,
            <span class="mono">P(H) = P(1000) − ΔPтаб</span>,
            <span class="mono">iP = 33.3 / ΔPтаб</span>.</li>
          <li>Норма: <span class="mono">iP = 0.32 ± 0.06</span> → <span class="mono">0.26…0.38</span>.</li>
        </ul>

        <table>
          <thead><tr><th>Параметр</th><th>Норма</th></tr></thead>
          <tbody>
            <tr><td>iT</td><td class="mono">0.68…1.02</td></tr>
            <tr><td>iP</td><td class="mono">0.26…0.38</td></tr>
            <tr><td>H (левая промежуточная отметка)</td><td class="mono">2021…3048 м</td></tr>
          </tbody>
        </table>

      </details>
      <div class="foot">
        Если хочешь, следующим шагом сделаю “режим работы как по карте”: кнопки «Зафиксировал 1000», «Левая отметка», «Правая отметка» (с журналом измерений).
      </div>
    </section>

  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  // ---------- Ввод чисел с запятой ----------
  const toNum = (v) => {
    if (typeof v !== 'string') return Number(v);
    v = v.trim().replace(',', '.');
    const n = Number(v);
    return Number.isFinite(n) ? n : NaN;
  };
  const fmt = (n, d=3) => Number.isFinite(n) ? n.toFixed(d) : '—';
  const inRange = (n,a,b) => Number.isFinite(n) && n >= a && n <= b;

  // ---------- НОРМЫ ----------
  const IP_MIN = 0.26, IP_MAX = 0.38;
  const IT_MIN = 0.68, IT_MAX = 1.02;
  const H_MIN  = 2021, H_MAX  = 3048;   // <-- ГЛАВНОЕ: диапазон это H (высота)

  // ---------- ГИПСОМЕТРИЧЕСКАЯ ТАБЛИЦА (твои значения) ----------
  // формат: [H(m), P(mmHg)]
  const HYPSO = [
    [0,   760.000],
    [20,  758.200],
    [40,  756.403],
    [60,  754.609],
    [100, 751.033],
    [200, 742.151],
    [300, 733.355],
    [400, 724.643],
    [500, 716.015],
    [600, 707.471],
    [700, 699.009],
    [800, 690.630],
    [900, 682.332],
    [1000,674.115],
    [1100,665.978],
    [1200,657.921],
    [1300,649.943],
    [1400,642.044],
    [1500,634.222],
    [1600,626.478],
    [1700,618.811],
    [1800,611.219],
    [1900,603.704],
    [2000,596.263],
    [2100,588.897],
    [2200,581.605],
    [2300,574.385],
    [2400,567.239],
    [2500,560.165],
    [2600,553.162],
    [2700,546.231],
    [2800,539.370],
    [2900,532.579],
    [3000,525.857],
  ];

  function ptabFromHypso(H){
    if(!Number.isFinite(H)) return NaN;
    // clamp
    if (H <= HYPSO[0][0]) return HYPSO[0][1];
    if (H >= HYPSO[HYPSO.length-1][0]) return HYPSO[HYPSO.length-1][1];

    // find segment for linear interpolation
    for(let i=0;i<HYPSO.length-1;i++){
      const [h1,p1] = HYPSO[i];
      const [h2,p2] = HYPSO[i+1];
      if (H >= h1 && H <= h2){
        const k = (H - h1) / (h2 - h1);
        return p1 + k * (p2 - p1);
      }
    }
    return NaN;
  }

  // ---------- Таблица R->T (как использовалось раньше) ----------
  const RT_TAB = [
    {T:-40, R:76.86},
    {T:-30, R:79.96},
    {T:-20, R:83.16},
    {T:-10, R:86.56},
    {T:  0, R:90.26},
    {T: 10, R:93.76},
    {T: 20, R:97.36},
    {T: 30, R:101.06},
    {T: 40, R:104.86},
    {T: 50, R:108.81},
    {T: 60, R:112.78},
    {T: 70, R:116.96},
    {T: 80, R:121.22},
    {T: 90, R:125.56},
    {T:110, R:134.41},
    {T:120, R:138.96},
    {T:130, R:143.56},
  ].slice().sort((a,b)=>a.R-b.R);

  function interpTfromR(R){
    if(!Number.isFinite(R)) return NaN;
    if (R <= RT_TAB[0].R) return RT_TAB[0].T;
    if (R >= RT_TAB[RT_TAB.length-1].R) return RT_TAB[RT_TAB.length-1].T;
    for(let i=0;i<RT_TAB.length-1;i++){
      const a=RT_TAB[i], b=RT_TAB[i+1];
      if(R>=a.R && R<=b.R){
        const k=(R-a.R)/(b.R-a.R);
        return a.T + k*(b.T-a.T);
      }
    }
    return NaN;
  }

  // ---------- UI helpers ----------
  function setBadge(el, kind, text){
    el.classList.remove('ok','bad','warn');
    el.classList.add(kind);
    el.textContent = text;
  }

  // ---------- Расчёт давления ----------
  function calcPressure(){
    const p1000 = toNum($('p1000').value);
    const H = toNum($('H').value);

    const ptab1000 = ptabFromHypso(1000);
    $('pt1000').textContent = fmt(ptab1000, 3);

    const ptabH = ptabFromHypso(H);
    $('ptH').textContent = fmt(ptabH, 3);

    const dP = (Number.isFinite(ptabH)) ? (ptab1000 - ptabH) : NaN;
    $('dP').textContent = fmt(dP, 3);

    const pH = (Number.isFinite(p1000) && Number.isFinite(dP)) ? (p1000 - dP) : NaN;
    $('pH').textContent = fmt(pH, 3);

    const iP = (Number.isFinite(dP) && dP !== 0) ? (33.3 / dP) : NaN;
    $('iP').textContent = fmt(iP, 3);

    // Контроль высоты по H (ВАЖНО!)
    let hText = '—';
    if(Number.isFinite(H)){
      hText = `${H.toFixed(0)} м (норма ${H_MIN}…${H_MAX})`;
    }
    $('hCheck').textContent = hText;

    // Статусы
    if(!Number.isFinite(p1000) || !Number.isFinite(H)){
      $('pMsg').textContent = 'Введи P(1000) и H.';
      setBadge($('pBadge'),'warn','НЕТ ДАННЫХ');
      return;
    }

    const okH  = inRange(H, H_MIN, H_MAX);
    const okIP = inRange(iP, IP_MIN, IP_MAX);

    if(okH && okIP){
      $('pMsg').textContent = `НОРМА: H в диапазоне и iP в норме (${IP_MIN}…${IP_MAX}).`;
      setBadge($('pBadge'),'ok','НОРМА');
    } else {
      const parts=[];
      if(!okH)  parts.push(`H=${H.toFixed(0)} м (нужно ${H_MIN}…${H_MAX}).`);
      if(!okIP) parts.push(`iP=${fmt(iP,3)} (нужно ${IP_MIN}…${IP_MAX}).`);
      $('pMsg').textContent = 'НЕ НОРМА: ' + parts.join(' ');
      setBadge($('pBadge'),'bad','НЕ НОРМА');
    }
  }

  // ---------- Расчёт температуры ----------
  function calcTemp(){
    const R1 = toNum($('R1').value);
    const R2 = toNum($('R2').value);

    const T1 = interpTfromR(R1);
    const T2 = interpTfromR(R2);

    $('T1').textContent = Number.isFinite(T1) ? T1.toFixed(2) : '—';
    $('T2').textContent = Number.isFinite(T2) ? T2.toFixed(2) : '—';

    const dT1 = Number.isFinite(T1) ? (T1 - 7) : NaN;
    const dT2 = Number.isFinite(T2) ? (T2 - 7) : NaN;

    $('dT1').textContent = Number.isFinite(dT1) ? dT1.toFixed(2) : '—';
    $('dT2').textContent = Number.isFinite(dT2) ? dT2.toFixed(2) : '—';

    const iT1 = (Number.isFinite(dT1) && dT1 !== 0) ? (33.3 / Math.abs(dT1)) : NaN;
    const iT2 = (Number.isFinite(dT2) && dT2 !== 0) ? (33.3 / Math.abs(dT2)) : NaN;

    $('iT1').textContent = fmt(iT1, 3);
    $('iT2').textContent = fmt(iT2, 3);

    const has1 = Number.isFinite(iT1);
    const has2 = Number.isFinite(iT2);

    // Итог: если одна точка — она и есть; если две — берём худшую (дальше от 0.85)
    let iTfinal = NaN;
    if(has1 && has2){
      const target = 0.85;
      iTfinal = (Math.abs(iT1-target) >= Math.abs(iT2-target)) ? iT1 : iT2;
    } else if(has1) iTfinal = iT1;
    else if(has2) iTfinal = iT2;

    $('iTfinal').textContent = fmt(iTfinal, 3);

    if(!has1 && !has2){
      $('tMsg').textContent = 'Введи R1 и/или R2 — можно даже одну точку.';
      setBadge($('tBadge'),'warn','НЕТ ДАННЫХ');
      return;
    }

    const ok = inRange(iTfinal, IT_MIN, IT_MAX);
    if(ok){
      $('tMsg').textContent = `НОРМА: iT в диапазоне ${IT_MIN}…${IT_MAX}.`;
      setBadge($('tBadge'),'ok','НОРМА');
    } else {
      $('tMsg').textContent = `НЕ НОРМА: iT=${fmt(iTfinal,3)} (нужно ${IT_MIN}…${IT_MAX}).`;
      setBadge($('tBadge'),'bad','НЕ НОРМА');
    }
  }

  function recalcAll(){ calcPressure(); calcTemp(); }

  // ---------- Таблицы на странице ----------
  function renderRT(){
    let html = '<table><thead><tr><th>T, °C</th><th>R, Ω</th></tr></thead><tbody>';
    for(const r of RT_TAB){
      html += `<tr><td class="mono">${r.T}</td><td class="mono">${r.R.toFixed(2)}</td></tr>`;
    }
    html += '</tbody></table>';
    $('rtWrap').innerHTML = html;
  }

  function renderHypso(){
    let html = '<table><thead><tr><th>H, м</th><th>Pтаб(H), мм рт.ст.</th></tr></thead><tbody>';
    for(const [h,p] of HYPSO){
      html += `<tr><td class="mono">${h}</td><td class="mono">${p.toFixed(3)}</td></tr>`;
    }
    html += '</tbody></table>';
    $('hypsoWrap').innerHTML = html;
  }

  // ---------- Init ----------
  window.addEventListener('DOMContentLoaded', () => {
    try{
      renderMathInElement(document.body, {
        delimiters: [{left:"$$", right:"$$", display:true},{left:"$", right:"$", display:false}],
        throwOnError:false
      });
      document.querySelectorAll('[data-katex]').forEach(el=>{
        katex.render(el.getAttribute('data-katex'), el, {throwOnError:false, displayMode:false});
      });
    }catch(e){}

    renderRT();
    recalcAll();

    ['p1000','H','R1','R2'].forEach(id => $(id).addEventListener('input', recalcAll));

    $('btnShowHypso').addEventListener('click', renderHypso);
    $('btnClearHypso').addEventListener('click', () => $('hypsoWrap').innerHTML = '');
  });

})();
</script>
</body>
</html>
