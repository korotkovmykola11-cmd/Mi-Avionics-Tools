<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>СПУУ-52-3 — расчёт передаточных чисел</title>

  <style>
    :root{
      --bg1:#0b4fb3;
      --bg2:#f5cf1f;
      --card:#0c2e63cc;
      --card2:#0c2e63aa;
      --text:#eaf2ff;
      --muted:#cfe0ff;
      --line:#ffffff22;
      --ok:#2ecc71;
      --bad:#ff5c5c;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --radius: 18px;
      --shadow: 0 10px 30px #00000033;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: linear-gradient(180deg, var(--bg1) 0%, #0a56c6 35%, var(--bg2) 36%, var(--bg2) 100%);
      min-height:100%;
    }

    .wrap{
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 18px 34px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    h1{
      margin:0;
      font-size: 34px;
      letter-spacing: .2px;
      font-weight: 800;
      text-shadow: 0 2px 0 #0000001a;
    }

    .pills{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      align-items:center;
      margin-top: 6px;
    }

    .pill{
      padding: 10px 12px;
      border-radius: 999px;
      background: #0b2b5fcc;
      border: 1px solid var(--line);
      color: var(--muted);
      font-size: 13px;
      box-shadow: 0 6px 18px #00000022;
      white-space: nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items: start;
    }

    @media (max-width: 980px){
      header{ flex-direction:column; align-items:flex-start; }
      .pills{ justify-content:flex-start; }
      .grid{ grid-template-columns: 1fr; }
      h1{ font-size: 28px; }
    }

    .card{
      border-radius: var(--radius);
      background: linear-gradient(180deg, var(--card) 0%, var(--card2) 100%);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHead{
      padding: 16px 16px 10px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
      align-items:flex-start;
      border-bottom: 1px solid var(--line);
    }

    .cardTitle{
      font-size: 16px;
      font-weight: 800;
      margin:0;
    }

    .rightTop{
      text-align:right;
      display:flex;
      flex-direction:column;
      gap: 6px;
      align-items:flex-end;
    }

    .formulaMini{
      font-family: var(--mono);
      font-size: 12px;
      color: #eaf2ffdd;
      background:#0000001f;
      border:1px solid var(--line);
      border-radius: 10px;
      padding: 6px 10px;
      white-space: nowrap;
    }

    .content{
      padding: 14px 16px 16px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    @media (max-width: 600px){
      .row{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background:#081f46cc;
      color:var(--text);
      outline:none;
      font-size: 14px;
    }
    input::placeholder{ color:#cfe0ff66; }

    .kv{
      display:flex;
      justify-content:space-between;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background:#0000001c;
      border:1px solid var(--line);
      margin-bottom: 10px;
    }
    .kv .k{
      color: var(--muted);
      font-size: 12px;
    }
    .kv .v{
      font-family: var(--mono);
      font-size: 13px;
      text-align:right;
      white-space:nowrap;
    }

    .big{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 12px;
      padding: 14px 14px;
      border-radius: 14px;
      background:#00000026;
      border: 1px solid var(--line);
      margin-top: 12px;
    }

    .big .val{
      font-size: 40px;
      font-weight: 900;
      letter-spacing: .6px;
    }
    .big .unit{
      opacity:.9;
      font-size: 13px;
      font-family: var(--mono);
      margin-left: 6px;
    }

    .badge{
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--line);
      font-weight: 900;
      font-size: 12px;
      letter-spacing: .3px;
      text-transform: uppercase;
      user-select:none;
    }
    .ok{ background: color-mix(in srgb, var(--ok) 22%, #0000); color:#d7ffe6; }
    .bad{ background: color-mix(in srgb, var(--bad) 22%, #0000); color:#ffe2e2; }
    .na { background:#ffffff14; color:#eaf2ffbb; }

    .statusBar{
      margin-top: 10px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid var(--line);
      font-weight: 900;
      letter-spacing:.3px;
      text-align:center;
    }

    .statusBar.ok{ background: color-mix(in srgb, var(--ok) 28%, #0000); }
    .statusBar.bad{ background: color-mix(in srgb, var(--bad) 28%, #0000); }
    .statusBar.na { background:#ffffff14; }

    .btnRow{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top: 12px;
    }

    button{
      border: 1px solid var(--line);
      background:#0b2b5fcc;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 800;
    }
    button:hover{ filter: brightness(1.08); }
    button:active{ transform: translateY(1px); }

    .tech{
      margin-top: 16px;
      border-radius: var(--radius);
      background: linear-gradient(180deg, #0c2e63b8 0%, #0c2e6390 100%);
      border: 1px solid var(--line);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .tech > summary{
      list-style:none;
      cursor:pointer;
      padding: 14px 16px;
      font-weight: 900;
      border-bottom: 1px solid var(--line);
      user-select:none;
    }
    .tech > summary::-webkit-details-marker{ display:none; }

    .techBody{
      padding: 14px 16px 16px;
      color: #eaf2ffea;
      line-height: 1.35;
      font-size: 14px;
    }
    .techBody h3{ margin: 12px 0 8px; font-size: 15px; }
    .techBody ul{ margin: 6px 0 10px 18px; }
    .techBody li{ margin: 6px 0; }
    .mono{ font-family: var(--mono); }
    .sep{ height:1px; background: var(--line); margin: 10px 0; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <h1>СПУУ-52-3 — расчёт передаточных чисел</h1>
      </div>

      <div class="pills">
        <div class="pill">Норма по высоте: <b>H = 2021…3048 м</b></div>
        <div class="pill">Норма i<sub>P</sub>: <b>0.32 ± 0.06</b> (0.26…0.38)</div>
        <div class="pill">Норма i<sub>T</sub>: <b>0.85 ± 0.17</b> (0.68…1.02)</div>
      </div>
    </header>

    <div class="grid">
      <!-- ДАВЛЕНИЕ / ВЫСОТА -->
      <section class="card" id="cardP">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Давление (по высоте)</div>
          </div>
          <div class="rightTop">
            <div class="formulaMini">i<sub>P</sub> = 33.3 / ΔP</div>
          </div>
        </div>

        <div class="content">
          <form autocomplete="off">
            <div class="row">
              <div>
                <label for="p1000">P(1000), мм рт.ст. (по прибору)</label>
                <input id="p1000" name="p1000_spuu" autocomplete="off" spellcheck="false" inputmode="decimal" placeholder="—" />
              </div>
              <div>
                <label for="hLeft">H, м (левая промежуточная отметка)</label>
                <input id="hLeft" name="hLeft_spuu" autocomplete="off" spellcheck="false" inputmode="numeric" placeholder="—" />
              </div>
            </div>
          </form>

          <div class="kv">
            <div class="k">Pтаб(H), мм рт.ст.</div>
            <div class="v" id="pTabH">—</div>
          </div>

          <div class="kv">
            <div class="k">ΔP = P(1000) − Pтаб(H), мм рт.ст.</div>
            <div class="v" id="dP">—</div>
          </div>

          <div class="big">
            <div>
              <span class="val" id="ip">—</span>
              <span class="unit">i<sub>P</sub></span>
            </div>
            <div class="badge na" id="badgeP">—</div>
          </div>

          <div class="btnRow">
            <button type="button" id="resetP">Сброс</button>
          </div>

          <div class="statusBar na" id="statusP">—</div>
        </div>
      </section>

      <!-- ТЕМПЕРАТУРА -->
      <section class="card" id="cardT">
        <div class="cardHead">
          <div>
            <div class="cardTitle">Температура</div>
          </div>
          <div class="rightTop">
            <div class="formulaMini">i<sub>T</sub> = 33.3 / |T − 7|</div>
          </div>
        </div>

        <div class="content">
          <form autocomplete="off">
            <div class="row">
              <div>
                <label for="tVal">T, °C (по таблице R→T / вводишь сразу T)</label>
                <input id="tVal" name="tVal_spuu" autocomplete="off" spellcheck="false" inputmode="decimal" placeholder="—" />
              </div>
              <div>
                <label for="tVal2">T2, °C (если нужно вторую точку — опционально)</label>
                <input id="tVal2" name="tVal2_spuu" autocomplete="off" spellcheck="false" inputmode="decimal" placeholder="—" />
              </div>
            </div>
          </form>

          <div class="kv">
            <div class="k">|ΔT| = |T − 7|</div>
            <div class="v" id="dT">—</div>
          </div>

          <div class="big">
            <div>
              <span class="val" id="it">—</span>
              <span class="unit">i<sub>T</sub></span>
            </div>
            <div class="badge na" id="badgeT">—</div>
          </div>

          <div class="btnRow">
            <button type="button" id="resetT">Сброс</button>
          </div>

          <div class="statusBar na" id="statusT">—</div>
        </div>
      </section>
    </div>

    <!-- ТЕХНОЛОГИЯ: по умолчанию закрыта -->
    <details class="tech" id="techBlock">
      <summary>Технологическая карта №91 — проверка параметров системы подвижных упоров управления СПУУ-52-3</summary>
      <div class="techBody">
        <h3>1. Внешний осмотр</h3>
        <p>Проверьте внешнее состояние и надёжность крепления блоков системы.</p>

        <h3>2. Подготовительные работы</h3>
        <ul>
          <li>Расконтрите и отсоедините штепсельный разъём от приёмника температуры П-1 и подключите вместо него магазин сопротивлений.</li>
          <li>Подсоедините к измерительному комплексу давления ИКД-27ДА установку КПУ-3 с высотомером.</li>
          <li>Снимите лицевую панель с пульта управления (блок БУ-32-3), предварительно отвернув два винта.</li>
          <li>Включите источники питания постоянного и переменного тока.</li>
          <li>Установите выключатель «ПОДВИЖ. УПОР» в положение «ВКЛ.»</li>
        </ul>

        <h3>3. Совмещение рисок / контроль крайних положений</h3>
        <ul>
          <li>Обеспечьте совмещение рисок датчика обратной связи с крайними отметками при предельных положениях.</li>
          <li>Проверьте крутизну сигнала датчика обратной связи согласно карте.</li>
        </ul>

        <div class="sep"></div>

        <h3>4. Проверка передаточного числа по температуре</h3>
        <p class="mono">i<sub>T</sub> = 33.3 / |T − 7|</p>
        <p>Температуру T берут по градуировочной таблице (R→T). В калькулятор вводишь уже значение T (чтобы не тянуть лишние таблицы в интерфейс).</p>
        <p>Допуск: <b>0.68…1.02</b>.</p>

        <div class="sep"></div>

        <h3>5. Проверка передаточного числа по давлению (по высоте)</h3>
        <p>Зафиксируйте P(1000) по прибору. Создайте разряжение до смещения индекса на левую промежуточную отметку и считайте высоту H.</p>
        <p class="mono">ΔP = P(1000) − Pтаб(H), i<sub>P</sub> = 33.3 / ΔP</p>
        <p>Сначала проверяют, что H в диапазоне <b>2021…3048</b>, затем считают i<sub>P</sub>. Допуск i<sub>P</sub>: <b>0.26…0.38</b>.</p>
      </div>
    </details>
  </div>

  <script>
    // ======= Нормы =======
    const NORM_IP = { min: 0.26, max: 0.38 };
    const NORM_IT = { min: 0.68, max: 1.02 };
    const NORM_H  = { min: 2021, max: 3048 };

    // ======= Утилиты =======
    const $ = (id) => document.getElementById(id);

    function toNum(v){
      const s = String(v ?? '').replace(',', '.').trim();
      if (!s) return NaN;
      const x = Number(s);
      return Number.isFinite(x) ? x : NaN;
    }

    function fmt(x, n=3){
      if (!Number.isFinite(x)) return '—';
      const k = Math.pow(10, n);
      return (Math.round(x*k)/k).toFixed(n);
    }

    function inRange(x, a, b){
      return Number.isFinite(x) && x >= a && x <= b;
    }

    function setBadge(el, ok){
      el.classList.remove('ok','bad','na');
      if (ok === null){
        el.classList.add('na');
        el.textContent = '—';
        return;
      }
      if (ok){
        el.classList.add('ok');
        el.textContent = 'НОРМА';
      }else{
        el.classList.add('bad');
        el.textContent = 'НЕ НОРМА';
      }
    }

    function setStatusBar(el, ok, text){
      el.classList.remove('ok','bad','na');
      if (ok === null){
        el.classList.add('na');
      }else if (ok){
        el.classList.add('ok');
      }else{
        el.classList.add('bad');
      }
      el.textContent = text || '—';
    }

    // ======= Гипсометрия: стандартная атмосфера (даёт твои значения типа 1000=674.115) =======
    // Давление в мм рт.ст. по высоте (м)
    function p_mmHg_by_h(h_m){
      // ISA troposphere
      // p = p0*(1 - L*h/T0)^(g0/(R*L))
      // p0 = 760 mmHg (на уровне моря), T0=288.15K, L=0.0065K/m
      const p0 = 760.0;
      const T0 = 288.15;
      const L  = 0.0065;
      const g0 = 9.80665;
      const R  = 287.05287; // specific gas constant for dry air

      const h = h_m;
      const term = 1 - (L * h) / T0;
      if (term <= 0) return NaN;
      const exp = g0 / (R * L);
      return p0 * Math.pow(term, exp);
    }

    // ======= Расчёты =======
    function calcPressure(){
      const p1000 = toNum($('p1000').value);
      const H = toNum($('hLeft').value);

      if (!Number.isFinite(p1000) || !Number.isFinite(H)){
        $('pTabH').textContent = '—';
        $('dP').textContent = '—';
        $('ip').textContent = '—';
        setBadge($('badgeP'), null);
        setStatusBar($('statusP'), null, '—');
        return;
      }

      const pTabH = p_mmHg_by_h(H);
      const dP = p1000 - pTabH;
      const ip = 33.3 / dP;

      $('pTabH').textContent = fmt(pTabH, 3);
      $('dP').textContent = fmt(dP, 3);
      $('ip').textContent = fmt(ip, 3);

      const okIP = inRange(ip, NORM_IP.min, NORM_IP.max);
      setBadge($('badgeP'), okIP);

      const okH = inRange(H, NORM_H.min, NORM_H.max);
      const statusText =
        `H=${Math.round(H)}м (${NORM_H.min}…${NORM_H.max}) ${okH ? 'ОК' : 'ВНЕ'}; ` +
        `iP=${fmt(ip,3)} (${NORM_IP.min}…${NORM_IP.max}) ${okIP ? 'НОРМА' : 'НЕ НОРМА'}.`;

      setStatusBar($('statusP'), okIP, statusText);
    }

    function calcTemp(){
      const T1 = toNum($('tVal').value);
      const T2 = toNum($('tVal2').value);

      if (!Number.isFinite(T1) && !Number.isFinite(T2)){
        $('dT').textContent = '—';
        $('it').textContent = '—';
        setBadge($('badgeT'), null);
        setStatusBar($('statusT'), null, '—');
        return;
      }

      function itByT(T){
        const dT = Math.abs(T - 7);
        return 33.3 / dT;
      }

      if (Number.isFinite(T1) && !Number.isFinite(T2)){
        const dT = Math.abs(T1 - 7);
        const it = 33.3 / dT;
        $('dT').textContent = fmt(dT, 3);
        $('it').textContent = fmt(it, 3);

        const ok = inRange(it, NORM_IT.min, NORM_IT.max);
        setBadge($('badgeT'), ok);
        setStatusBar($('statusT'), ok, `iT=${fmt(it,3)} (${NORM_IT.min}…${NORM_IT.max}) ${ok ? 'НОРМА' : 'НЕ НОРМА'}.`);
        return;
      }

      // Если введены две точки — показываем "хуже" для статуса
      const it1 = Number.isFinite(T1) ? itByT(T1) : NaN;
      const it2 = Number.isFinite(T2) ? itByT(T2) : NaN;

      const ok1 = Number.isFinite(it1) ? inRange(it1, NORM_IT.min, NORM_IT.max) : true;
      const ok2 = Number.isFinite(it2) ? inRange(it2, NORM_IT.min, NORM_IT.max) : true;

      // худший = если хоть один вне допуска — берём вне допуска; иначе берём ближе к границе
      let it = it1;
      if (!ok1 && ok2) it = it1;
      else if (!ok2 && ok1) it = it2;
      else if (!ok1 && !ok2){
        // оба плохие — берём более "плохой"
        const dist1 = (it1 < NORM_IT.min) ? (NORM_IT.min - it1) : (it1 - NORM_IT.max);
        const dist2 = (it2 < NORM_IT.min) ? (NORM_IT.min - it2) : (it2 - NORM_IT.max);
        it = (dist1 >= dist2) ? it1 : it2;
      }else{
        // оба в норме — худший ближе к границе
        const m1 = Math.min(it1 - NORM_IT.min, NORM_IT.max - it1);
        const m2 = Math.min(it2 - NORM_IT.min, NORM_IT.max - it2);
        it = (m1 <= m2) ? it1 : it2;
      }

      const dTtext = [];
      if (Number.isFinite(T1)) dTtext.push(`|ΔT1|=${fmt(Math.abs(T1-7),3)}`);
      if (Number.isFinite(T2)) dTtext.push(`|ΔT2|=${fmt(Math.abs(T2-7),3)}`);
      $('dT').textContent = dTtext.join('; ');

      $('it').textContent = fmt(it, 3);
      const ok = inRange(it, NORM_IT.min, NORM_IT.max);
      setBadge($('badgeT'), ok);
      setStatusBar($('statusT'), ok, `iT=${fmt(it,3)} (${NORM_IT.min}…${NORM_IT.max}) ${ok ? 'НОРМА' : 'НЕ НОРМА'}.`);
    }

    // ======= Принудительно очищаем поля при старте (убирает автоподстановку браузера) =======
    function forceEmptyOnLoad(){
      const ids = ['p1000','hLeft','tVal','tVal2'];
      for (const id of ids){
        const el = $(id);
        el.value = '';
        el.defaultValue = '';
      }
      // результаты в прочерки
      $('pTabH').textContent = '—';
      $('dP').textContent = '—';
      $('ip').textContent = '—';
      setBadge($('badgeP'), null);
      setStatusBar($('statusP'), null, '—');

      $('dT').textContent = '—';
      $('it').textContent = '—';
      setBadge($('badgeT'), null);
      setStatusBar($('statusT'), null, '—');

      // технология закрыта
      $('techBlock').open = false;
    }

    function bind(){
      $('p1000').addEventListener('input', calcPressure);
      $('hLeft').addEventListener('input', calcPressure);

      $('tVal').addEventListener('input', calcTemp);
      $('tVal2').addEventListener('input', calcTemp);

      $('resetP').addEventListener('click', () => {
        $('p1000').value = '';
        $('hLeft').value = '';
        calcPressure();
      });

      $('resetT').addEventListener('click', () => {
        $('tVal').value = '';
        $('tVal2').value = '';
        calcTemp();
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      bind();
      // Делаем очистку чуть позже, чтобы перебить автозаполнение браузера
      setTimeout(forceEmptyOnLoad, 0);
      setTimeout(forceEmptyOnLoad, 50);
    });
  </script>
</body>
</html>
